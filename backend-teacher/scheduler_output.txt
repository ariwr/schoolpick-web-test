1. Setup Test Data...
2025-12-26 18:55:02,589 INFO sqlalchemy.engine.Engine select pg_catalog.version()
2025-12-26 18:55:02,589 INFO sqlalchemy.engine.Engine [raw sql] {}
2025-12-26 18:55:02,610 INFO sqlalchemy.engine.Engine select current_schema()
2025-12-26 18:55:02,610 INFO sqlalchemy.engine.Engine [raw sql] {}
2025-12-26 18:55:02,627 INFO sqlalchemy.engine.Engine show standard_conforming_strings
2025-12-26 18:55:02,627 INFO sqlalchemy.engine.Engine [raw sql] {}
2025-12-26 18:55:02,646 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-26 18:55:02,651 INFO sqlalchemy.engine.Engine SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.phone AS users_phone, users.birth_date AS users_birth_date, users.user_type AS users_user_type, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s
2025-12-26 18:55:02,651 INFO sqlalchemy.engine.Engine [generated in 0.00037s] {'email_1': 'scheduler_test@test.com', 'param_1': 1}
2025-12-26 18:55:02,670 INFO sqlalchemy.engine.Engine SELECT school_configurations.id AS school_configurations_id, school_configurations.user_id AS school_configurations_user_id, school_configurations.school_name AS school_configurations_school_name, school_configurations.total_grades AS school_configurations_total_grades, school_configurations.periods_per_day AS school_configurations_periods_per_day, school_configurations.days_per_week AS school_configurations_days_per_week, school_configurations.lunch_period AS school_configurations_lunch_period, school_configurations.created_at AS school_configurations_created_at, school_configurations.updated_at AS school_configurations_updated_at 
FROM school_configurations 
WHERE school_configurations.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
2025-12-26 18:55:02,670 INFO sqlalchemy.engine.Engine [generated in 0.00022s] {'user_id_1': 56, 'param_1': 1}
2025-12-26 18:55:02,680 INFO sqlalchemy.engine.Engine INSERT INTO schedule_metadata (version_name, description, is_active, is_published, updated_at) VALUES (%(version_name)s, %(description)s, %(is_active)s, %(is_published)s, %(updated_at)s) RETURNING schedule_metadata.id, schedule_metadata.created_at
2025-12-26 18:55:02,680 INFO sqlalchemy.engine.Engine [generated in 0.00022s] {'version_name': 'SchedulerTest', 'description': None, 'is_active': False, 'is_published': False, 'updated_at': None}
2025-12-26 18:55:02,688 INFO sqlalchemy.engine.Engine COMMIT
2025-12-26 18:55:02,706 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-26 18:55:02,707 INFO sqlalchemy.engine.Engine SELECT schedule_metadata.id, schedule_metadata.version_name, schedule_metadata.description, schedule_metadata.is_active, schedule_metadata.is_published, schedule_metadata.created_at, schedule_metadata.updated_at 
FROM schedule_metadata 
WHERE schedule_metadata.id = %(pk_1)s
2025-12-26 18:55:02,707 INFO sqlalchemy.engine.Engine [generated in 0.00015s] {'pk_1': 4}
2025-12-26 18:55:02,732 INFO sqlalchemy.engine.Engine SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.phone AS users_phone, users.birth_date AS users_birth_date, users.user_type AS users_user_type, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %(pk_1)s
2025-12-26 18:55:02,732 INFO sqlalchemy.engine.Engine [generated in 0.00018s] {'pk_1': 56}
2025-12-26 18:55:02,745 INFO sqlalchemy.engine.Engine INSERT INTO subjects (name, code, user_id, department_id, required_hours, target_grade, category, required_facility_id, created_at) SELECT p0::VARCHAR, p1::VARCHAR, p2::INTEGER, p3::INTEGER, p4::INTEGER, p5::INTEGER, p6::VARCHAR, p7::INTEGER, p8::TIM ... 415 characters truncated ... 3, p4, p5, p6, p7, p8, sen_counter) ORDER BY sen_counter RETURNING subjects.id, subjects.id AS id__1
2025-12-26 18:55:02,745 INFO sqlalchemy.engine.Engine [generated in 0.00012s (insertmanyvalues) 1/1 (ordered)] {'department_id__0': None, 'code__0': None, 'required_facility_id__0': None, 'category__0': None, 'target_grade__0': None, 'name__0': 'Math', 'required_hours__0': 2, 'created_at__0': None, 'user_id__0': 56, 'department_id__1': None, 'code__1': None, 'required_facility_id__1': None, 'category__1': None, 'target_grade__1': None, 'name__1': 'English', 'required_hours__1': 2, 'created_at__1': None, 'user_id__1': 56}
2025-12-26 18:55:02,755 INFO sqlalchemy.engine.Engine INSERT INTO teachers (user_id, teacher_number, school_id, name, owner_id, position, hire_date, is_homeroom_teacher, created_at, updated_at, certification_number, department_id, max_hours_per_week) SELECT p0::INTEGER, p1::VARCHAR, p2::INTEGER, p3::VAR ... 754 characters truncated ... p8, p9, p10, p11, p12, sen_counter) ORDER BY sen_counter RETURNING teachers.id, teachers.id AS id__1
2025-12-26 18:55:02,756 INFO sqlalchemy.engine.Engine [generated in 0.00010s (insertmanyvalues) 1/1 (ordered)] {'certification_number__0': None, 'department_id__0': None, 'position__0': '����', 'school_id__0': None, 'max_hours_per_week__0': 15, 'hire_date__0': None, 'teacher_number__0': 'ST1', 'is_homeroom_teacher__0': False, 'owner_id__0': None, 'name__0': 'T1', 'updated_at__0': None, 'created_at__0': None, 'user_id__0': 56, 'certification_number__1': None, 'department_id__1': None, 'position__1': '����', 'school_id__1': None, 'max_hours_per_week__1': 15, 'hire_date__1': None, 'teacher_number__1': 'ST2', 'is_homeroom_teacher__1': False, 'owner_id__1': None, 'name__1': 'T2', 'updated_at__1': None, 'created_at__1': None, 'user_id__1': 56}
2025-12-26 18:55:02,765 INFO sqlalchemy.engine.Engine COMMIT
2025-12-26 18:55:02,786 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-26 18:55:02,787 INFO sqlalchemy.engine.Engine SELECT schedule_metadata.id AS schedule_metadata_id, schedule_metadata.version_name AS schedule_metadata_version_name, schedule_metadata.description AS schedule_metadata_description, schedule_metadata.is_active AS schedule_metadata_is_active, schedule_metadata.is_published AS schedule_metadata_is_published, schedule_metadata.created_at AS schedule_metadata_created_at, schedule_metadata.updated_at AS schedule_metadata_updated_at 
FROM schedule_metadata 
WHERE schedule_metadata.id = %(pk_1)s
2025-12-26 18:55:02,787 INFO sqlalchemy.engine.Engine [generated in 0.00019s] {'pk_1': 4}
2025-12-26 18:55:02,808 INFO sqlalchemy.engine.Engine SELECT subjects.id AS subjects_id, subjects.name AS subjects_name, subjects.code AS subjects_code, subjects.user_id AS subjects_user_id, subjects.department_id AS subjects_department_id, subjects.required_hours AS subjects_required_hours, subjects.target_grade AS subjects_target_grade, subjects.category AS subjects_category, subjects.required_facility_id AS subjects_required_facility_id, subjects.created_at AS subjects_created_at 
FROM subjects 
WHERE subjects.id = %(pk_1)s
2025-12-26 18:55:02,808 INFO sqlalchemy.engine.Engine [generated in 0.00021s] {'pk_1': 1289}
2025-12-26 18:55:02,818 INFO sqlalchemy.engine.Engine SELECT teachers.id AS teachers_id, teachers.user_id AS teachers_user_id, teachers.teacher_number AS teachers_teacher_number, teachers.school_id AS teachers_school_id, teachers.name AS teachers_name, teachers.owner_id AS teachers_owner_id, teachers.position AS teachers_position, teachers.hire_date AS teachers_hire_date, teachers.is_homeroom_teacher AS teachers_is_homeroom_teacher, teachers.created_at AS teachers_created_at, teachers.updated_at AS teachers_updated_at, teachers.certification_number AS teachers_certification_number, teachers.department_id AS teachers_department_id, teachers.max_hours_per_week AS teachers_max_hours_per_week 
FROM teachers 
WHERE teachers.id = %(pk_1)s
2025-12-26 18:55:02,818 INFO sqlalchemy.engine.Engine [generated in 0.00021s] {'pk_1': 10}
2025-12-26 18:55:02,827 INFO sqlalchemy.engine.Engine SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.phone AS users_phone, users.birth_date AS users_birth_date, users.user_type AS users_user_type, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %(pk_1)s
2025-12-26 18:55:02,827 INFO sqlalchemy.engine.Engine [cached since 0.09499s ago] {'pk_1': 56}
2025-12-26 18:55:02,835 INFO sqlalchemy.engine.Engine SELECT subjects.id AS subjects_id, subjects.name AS subjects_name, subjects.code AS subjects_code, subjects.user_id AS subjects_user_id, subjects.department_id AS subjects_department_id, subjects.required_hours AS subjects_required_hours, subjects.target_grade AS subjects_target_grade, subjects.category AS subjects_category, subjects.required_facility_id AS subjects_required_facility_id, subjects.created_at AS subjects_created_at 
FROM subjects 
WHERE subjects.id = %(pk_1)s
2025-12-26 18:55:02,835 INFO sqlalchemy.engine.Engine [cached since 0.02692s ago] {'pk_1': 1290}
2025-12-26 18:55:02,843 INFO sqlalchemy.engine.Engine SELECT teachers.id AS teachers_id, teachers.user_id AS teachers_user_id, teachers.teacher_number AS teachers_teacher_number, teachers.school_id AS teachers_school_id, teachers.name AS teachers_name, teachers.owner_id AS teachers_owner_id, teachers.position AS teachers_position, teachers.hire_date AS teachers_hire_date, teachers.is_homeroom_teacher AS teachers_is_homeroom_teacher, teachers.created_at AS teachers_created_at, teachers.updated_at AS teachers_updated_at, teachers.certification_number AS teachers_certification_number, teachers.department_id AS teachers_department_id, teachers.max_hours_per_week AS teachers_max_hours_per_week 
FROM teachers 
WHERE teachers.id = %(pk_1)s
2025-12-26 18:55:02,843 INFO sqlalchemy.engine.Engine [cached since 0.02511s ago] {'pk_1': 11}
2025-12-26 18:55:02,858 INFO sqlalchemy.engine.Engine INSERT INTO lecture_groups (schedule_id, subject_id, teacher_id, grade, class_num, total_credits, slicing_option, neis_class_code, student_count, user_id) SELECT p0::INTEGER, p1::INTEGER, p2::INTEGER, p3::INTEGER, p4::INTEGER, p5::INTEGER, p6::VARCHA ... 727 characters truncated ... ER BY sen_counter RETURNING lecture_groups.id, lecture_groups.created_at, lecture_groups.id AS id__1
2025-12-26 18:55:02,858 INFO sqlalchemy.engine.Engine [generated in 0.00012s (insertmanyvalues) 1/1 (ordered)] {'subject_id__0': 1289, 'neis_class_code__0': None, 'total_credits__0': 4, 'student_count__0': None, 'slicing_option__0': None, 'class_num__0': None, 'grade__0': 1, 'schedule_id__0': 4, 'teacher_id__0': 10, 'user_id__0': 56, 'subject_id__1': 1290, 'neis_class_code__1': None, 'total_credits__1': 3, 'student_count__1': None, 'slicing_option__1': None, 'class_num__1': 1, 'grade__1': 1, 'schedule_id__1': 4, 'teacher_id__1': 11, 'user_id__1': 56, 'subject_id__2': 1289, 'neis_class_code__2': None, 'total_credits__2': 2, 'student_count__2': None, 'slicing_option__2': None, 'class_num__2': None, 'grade__2': 2, 'schedule_id__2': 4, 'teacher_id__2': 10, 'user_id__2': 56}
2025-12-26 18:55:02,870 INFO sqlalchemy.engine.Engine COMMIT
2. Run Scheduler...
2025-12-26 18:55:02,888 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-26 18:55:02,888 INFO sqlalchemy.engine.Engine SELECT schedule_metadata.id AS schedule_metadata_id, schedule_metadata.version_name AS schedule_metadata_version_name, schedule_metadata.description AS schedule_metadata_description, schedule_metadata.is_active AS schedule_metadata_is_active, schedule_metadata.is_published AS schedule_metadata_is_published, schedule_metadata.created_at AS schedule_metadata_created_at, schedule_metadata.updated_at AS schedule_metadata_updated_at 
FROM schedule_metadata 
WHERE schedule_metadata.id = %(pk_1)s
2025-12-26 18:55:02,888 INFO sqlalchemy.engine.Engine [cached since 0.1009s ago] {'pk_1': 4}
2025-12-26 18:55:02,912 INFO sqlalchemy.engine.Engine SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.phone AS users_phone, users.birth_date AS users_birth_date, users.user_type AS users_user_type, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %(pk_1)s
2025-12-26 18:55:02,912 INFO sqlalchemy.engine.Engine [cached since 0.1804s ago] {'pk_1': 56}
2025-12-26 18:55:02,920 INFO sqlalchemy.engine.Engine SELECT school_configurations.id AS school_configurations_id, school_configurations.user_id AS school_configurations_user_id, school_configurations.school_name AS school_configurations_school_name, school_configurations.total_grades AS school_configurations_total_grades, school_configurations.periods_per_day AS school_configurations_periods_per_day, school_configurations.days_per_week AS school_configurations_days_per_week, school_configurations.lunch_period AS school_configurations_lunch_period, school_configurations.created_at AS school_configurations_created_at, school_configurations.updated_at AS school_configurations_updated_at 
FROM school_configurations 
WHERE school_configurations.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
2025-12-26 18:55:02,920 INFO sqlalchemy.engine.Engine [cached since 0.2495s ago] {'user_id_1': 56, 'param_1': 1}
2025-12-26 18:55:02,933 INFO sqlalchemy.engine.Engine SELECT teacher_time_offs.id AS teacher_time_offs_id, teacher_time_offs.user_id AS teacher_time_offs_user_id, teacher_time_offs.teacher_id AS teacher_time_offs_teacher_id, teacher_time_offs.day AS teacher_time_offs_day, teacher_time_offs.period AS teacher_time_offs_period, teacher_time_offs.reason AS teacher_time_offs_reason, teacher_time_offs.created_at AS teacher_time_offs_created_at 
FROM teacher_time_offs 
WHERE teacher_time_offs.user_id = %(user_id_1)s
2025-12-26 18:55:02,933 INFO sqlalchemy.engine.Engine [generated in 0.00029s] {'user_id_1': 56}
2025-12-26 18:55:02,942 INFO sqlalchemy.engine.Engine SELECT lecture_blocks.id AS lecture_blocks_id, lecture_blocks.group_id AS lecture_blocks_group_id, lecture_blocks.day AS lecture_blocks_day, lecture_blocks.period AS lecture_blocks_period, lecture_blocks.room_id AS lecture_blocks_room_id, lecture_blocks.is_fixed AS lecture_blocks_is_fixed, lecture_blocks.created_at AS lecture_blocks_created_at 
FROM lecture_blocks JOIN lecture_groups ON lecture_groups.id = lecture_blocks.group_id 
WHERE lecture_groups.schedule_id = %(schedule_id_1)s
2025-12-26 18:55:02,942 INFO sqlalchemy.engine.Engine [generated in 0.00019s] {'schedule_id_1': 4}
2025-12-26 18:55:02,956 INFO sqlalchemy.engine.Engine SELECT lecture_groups.id AS lecture_groups_id, lecture_groups.schedule_id AS lecture_groups_schedule_id, lecture_groups.subject_id AS lecture_groups_subject_id, lecture_groups.teacher_id AS lecture_groups_teacher_id, lecture_groups.grade AS lecture_groups_grade, lecture_groups.class_num AS lecture_groups_class_num, lecture_groups.total_credits AS lecture_groups_total_credits, lecture_groups.slicing_option AS lecture_groups_slicing_option, lecture_groups.neis_class_code AS lecture_groups_neis_class_code, lecture_groups.student_count AS lecture_groups_student_count, lecture_groups.created_at AS lecture_groups_created_at, lecture_groups.user_id AS lecture_groups_user_id 
FROM lecture_groups 
WHERE lecture_groups.schedule_id = %(schedule_id_1)s
2025-12-26 18:55:02,956 INFO sqlalchemy.engine.Engine [generated in 0.00018s] {'schedule_id_1': 4}
2025-12-26 18:55:02,968 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT lecture_blocks.id AS lecture_blocks_id, lecture_blocks.group_id AS lecture_blocks_group_id, lecture_blocks.day AS lecture_blocks_day, lecture_blocks.period AS lecture_blocks_period, lecture_blocks.room_id AS lecture_blocks_room_id, lecture_blocks.is_fixed AS lecture_blocks_is_fixed, lecture_blocks.created_at AS lecture_blocks_created_at 
FROM lecture_blocks 
WHERE lecture_blocks.group_id = %(group_id_1)s) AS anon_1
2025-12-26 18:55:02,969 INFO sqlalchemy.engine.Engine [generated in 0.00015s] {'group_id_1': 8}
2025-12-26 18:55:02,981 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT lecture_blocks.id AS lecture_blocks_id, lecture_blocks.group_id AS lecture_blocks_group_id, lecture_blocks.day AS lecture_blocks_day, lecture_blocks.period AS lecture_blocks_period, lecture_blocks.room_id AS lecture_blocks_room_id, lecture_blocks.is_fixed AS lecture_blocks_is_fixed, lecture_blocks.created_at AS lecture_blocks_created_at 
FROM lecture_blocks 
WHERE lecture_blocks.group_id = %(group_id_1)s) AS anon_1
2025-12-26 18:55:02,981 INFO sqlalchemy.engine.Engine [cached since 0.01223s ago] {'group_id_1': 9}
2025-12-26 18:55:02,989 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT lecture_blocks.id AS lecture_blocks_id, lecture_blocks.group_id AS lecture_blocks_group_id, lecture_blocks.day AS lecture_blocks_day, lecture_blocks.period AS lecture_blocks_period, lecture_blocks.room_id AS lecture_blocks_room_id, lecture_blocks.is_fixed AS lecture_blocks_is_fixed, lecture_blocks.created_at AS lecture_blocks_created_at 
FROM lecture_blocks 
WHERE lecture_blocks.group_id = %(group_id_1)s) AS anon_1
2025-12-26 18:55:02,989 INFO sqlalchemy.engine.Engine [cached since 0.02043s ago] {'group_id_1': 10}
2025-12-26 18:55:02,997 INFO sqlalchemy.engine.Engine SELECT subjects.id AS subjects_id, subjects.name AS subjects_name, subjects.code AS subjects_code, subjects.user_id AS subjects_user_id, subjects.department_id AS subjects_department_id, subjects.required_hours AS subjects_required_hours, subjects.target_grade AS subjects_target_grade, subjects.category AS subjects_category, subjects.required_facility_id AS subjects_required_facility_id, subjects.created_at AS subjects_created_at 
FROM subjects 
WHERE subjects.id = %(pk_1)s
2025-12-26 18:55:02,997 INFO sqlalchemy.engine.Engine [cached since 0.1893s ago] {'pk_1': 1289}
2025-12-26 18:55:03,008 INFO sqlalchemy.engine.Engine SELECT subjects.id AS subjects_id, subjects.name AS subjects_name, subjects.code AS subjects_code, subjects.user_id AS subjects_user_id, subjects.department_id AS subjects_department_id, subjects.required_hours AS subjects_required_hours, subjects.target_grade AS subjects_target_grade, subjects.category AS subjects_category, subjects.required_facility_id AS subjects_required_facility_id, subjects.created_at AS subjects_created_at 
FROM subjects 
WHERE subjects.id = %(pk_1)s
2025-12-26 18:55:03,008 INFO sqlalchemy.engine.Engine [cached since 0.2007s ago] {'pk_1': 1290}
   Success! Created 9 blocks.
3. Verify Blocks...
   - Group 8 at MON 1
   - Group 8 at MON 2
   - Group 8 at MON 3
   - Group 8 at MON 4
   - Group 9 at MON 1
   - Group 9 at MON 2
   - Group 9 at MON 3
   - Group 10 at MON 5
   - Group 10 at MON 6
   PASS: Block count matches
4. Cleanup...
ERROR: Can't call Query.update() or Query.delete() when join(), outerjoin(), select_from(), or from_self() has been called
2025-12-26 18:55:03,028 INFO sqlalchemy.engine.Engine ROLLBACK
